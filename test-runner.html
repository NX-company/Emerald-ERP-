<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sales E2E Test Runner</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      border-radius: 8px;
      padding: 30px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
    }
    .instructions {
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
    }
    .instructions ol {
      margin: 10px 0;
      padding-left: 20px;
    }
    .instructions li {
      margin: 8px 0;
    }
    .button-group {
      margin: 20px 0;
      display: flex;
      gap: 10px;
    }
    button {
      background: #2196f3;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background: #1976d2;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .status {
      margin: 20px 0;
      padding: 15px;
      border-radius: 4px;
      font-weight: 500;
    }
    .status.info {
      background: #e3f2fd;
      color: #1976d2;
    }
    .status.success {
      background: #e8f5e9;
      color: #2e7d32;
    }
    .status.error {
      background: #ffebee;
      color: #c62828;
    }
    .console-output {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      max-height: 400px;
      overflow-y: auto;
      margin-top: 20px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .warning {
      background: #fff3e0;
      border-left: 4px solid #ff9800;
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß™ Sales Module E2E Test Runner</h1>
    <p>This page helps you run comprehensive End-to-End tests for the Sales (CRM) module.</p>

    <div class="instructions">
      <h3>üìã Test Instructions:</h3>
      <ol>
        <li><strong>Navigate to Sales Page:</strong> Open the Sales page in a new tab or window (/sales)</li>
        <li><strong>Open Browser Console:</strong> Press F12 or Ctrl+Shift+I (Cmd+Option+I on Mac)</li>
        <li><strong>Ensure Data:</strong> Make sure there's at least one existing deal in the system</li>
        <li><strong>Run Test:</strong> Click the "Run E2E Test" button below</li>
        <li><strong>Watch Console:</strong> The test will run automatically and show results in the console</li>
      </ol>
    </div>

    <div class="warning">
      <strong>‚ö†Ô∏è Important:</strong> This test runner page is just for instructions. The actual test must be run 
      on the <strong>/sales</strong> page. Follow the steps below to run the test.
    </div>

    <div class="button-group">
      <button onclick="window.open('/sales', '_blank')">Open Sales Page</button>
      <button onclick="copyTestScript()">Copy Test Script to Clipboard</button>
    </div>

    <div id="status" class="status info">
      ‚ÑπÔ∏è Ready to test. Follow the instructions above.
    </div>

    <h3>üîß Manual Test Execution (Alternative Method):</h3>
    <p>If the automatic method doesn't work, follow these steps:</p>
    <ol>
      <li>Open the Sales page (/sales) in your browser</li>
      <li>Open the browser console (F12)</li>
      <li>Copy and paste the entire test script below into the console</li>
      <li>Press Enter to load the script</li>
      <li>Run the test by typing: <code>runSalesE2ETest()</code></li>
    </ol>

    <h3>üìù Test Script:</h3>
    <div class="console-output" id="scriptContent">Loading test script...</div>

    <div class="instructions" style="margin-top: 20px;">
      <h3>‚úÖ What the test covers:</h3>
      <ul>
        <li>Opening existing deal details (Read operation)</li>
        <li>Verifying form data loads correctly</li>
        <li>Closing deal detail sheet</li>
        <li>Creating a new deal with unique data (Create operation)</li>
        <li>Verifying new deal appears in the list</li>
        <li>Editing the created deal (Update operation)</li>
        <li>Verifying updated data</li>
        <li>Deleting the deal (Delete operation)</li>
        <li>Verifying deal is removed from the list</li>
      </ul>
    </div>
  </div>

  <script type="module">
    import { nanoid } from 'https://cdn.jsdelivr.net/npm/nanoid@5/index.browser.js';

    // Load test script content
    fetch('/test-sales-e2e.js')
      .then(res => res.text())
      .then(script => {
        document.getElementById('scriptContent').textContent = script;
      })
      .catch(err => {
        document.getElementById('scriptContent').textContent = 'Error loading test script: ' + err.message;
      });

    window.copyTestScript = async function() {
      try {
        const script = document.getElementById('scriptContent').textContent;
        await navigator.clipboard.writeText(script);
        const statusEl = document.getElementById('status');
        statusEl.className = 'status success';
        statusEl.textContent = '‚úÖ Test script copied to clipboard! Now paste it in the browser console on the /sales page.';
      } catch (err) {
        const statusEl = document.getElementById('status');
        statusEl.className = 'status error';
        statusEl.textContent = '‚ùå Failed to copy script: ' + err.message;
      }
    };

    // Check if we're on the sales page
    if (window.location.pathname.includes('/sales')) {
      document.querySelector('.warning').innerHTML = 
        '<strong>‚úÖ Great!</strong> You are on the Sales page. Open the console and run the test script.';
      
      // Auto-load the test script if on sales page
      fetch('/test-sales-e2e.js')
        .then(res => res.text())
        .then(script => {
          // Create a script element and execute it
          const scriptEl = document.createElement('script');
          scriptEl.type = 'module';
          scriptEl.textContent = script;
          document.head.appendChild(scriptEl);
          
          const statusEl = document.getElementById('status');
          statusEl.className = 'status success';
          statusEl.innerHTML = '‚úÖ Test script loaded! Open console and run: <code>runSalesE2ETest()</code>';
        });
    }
  </script>
</body>
</html>
